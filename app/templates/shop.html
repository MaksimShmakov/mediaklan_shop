{% extends "base.html" %}

{% block content %}
<section class="hero">
  <div>
    <h1>{{ "Обычный" if shop_type == "regular" else "Премиум" }} магазин</h1>
    <p>Баллы списываются мгновенно. После покупки мы напишем в Telegram.</p>
  </div>
</section>

{% if not allowed %}
<section class="card panel">
  <h2>Доступ закрыт</h2>
  <p>Редакторы пока не открыли для вас этот магазин. Если это ошибка — напишите куратору.</p>
</section>
{% elif not open_now %}
<section class="card panel">
  <h2>Магазин в данный момент не работает</h2>
  <p>
    {% if settings and settings.opens_at and settings.closes_at %}
    Окно продаж: {{ settings.opens_at.strftime('%d.%m %H:%M') }} — {{ settings.closes_at.strftime('%d.%m %H:%M') }}
    {% else %}
    Время работы еще не настроено.
    {% endif %}
  </p>
</section>
{% else %}
<section class="grid product-grid">
  {% for product in products %}
  {% set active_variants = product.variants | selectattr('active') | list %}
  {% set costs = active_variants | map(attribute='points_cost') | list %}
  {% set variants_count = active_variants | length %}
  <a class="card product-card product-card--link" href="/shop/{{ shop_type }}/product/{{ product.id }}">
    <div class="product-card__media">
      {% if product.image_url %}
      <img src="{{ product.image_url }}" alt="{{ product.title }}" />
      {% else %}
      <div class="image-placeholder">Фото</div>
      {% endif %}
    </div>
    <div class="product-card__body">
      <h3>{{ product.title }}</h3>
      <p class="muted clamp-3">{{ product.description or "" }}</p>
      {% if costs %}
      <div class="product-card__meta">
        {% if variants_count == 1 %}
        <span class="pill pill--inline">{{ costs | min }} баллов</span>
        {% elif variants_count > 1 %}
        <span class="pill pill--inline">от {{ costs | min }} баллов</span>
        <span class="pill pill--muted">{{ variants_count }} вариантов</span>
        {% endif %}
      </div>
      {% endif %}
    </div>
  </a>
  {% endfor %}
</section>
{% endif %}

<div class="toast" id="toast"></div>
{% endblock %}

{% block scripts %}
<script src="/static/js/shop.js"></script>
{% endblock %}
